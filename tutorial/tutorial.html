<!DOCTYPE html>
<meta charset="utf-8">
<link href="vendor/tutorial.css" rel="stylesheet">
<script src="../src/vendor/jquery.js"></script>
<script src="vendor/tutorial.js"></script>
<script src="vendor/bacon.js"></script>
<style>
section {
  display: none;
  line-height: 20px;
}

code {
  border: 1px solid gray;
  border-radius: 2px;
  background-color: #f0f0f0;
  padding: 1px;
}
</style>
<script>
  function getCurrHash() { return window.location.hash; }

  function getStorage(key, defaultValue) {
    try {
      return JSON.parse(sessionStorage[key]);
    } catch (e) {
      return defaultValue;
    }
  }

  function setStorage(key, value) {
    try {
      sessionStorage[key] = JSON.stringify(value);
    } catch (e) {}
  }

  var HISTORY_START = getStorage('hashHistory', []);

  $(function() {
    $('body').tutorial({
      paginate: false
    });

    var hashHistory = Bacon.update(
      HISTORY_START,

      [$('#back').asEventStream('click')],
      function(history) { return history.slice(0, -1); },

      [$('body').asEventStream('click', 'a[href^="#"]', getCurrHash)],
      function(history, hash) { return history.concat(hash); }
    );

    hashHistory
      .diff(HISTORY_START, function(prev, curr) {
        return prev.length > curr.length ? prev[prev.length-1] : null;
      })
      .filter(function(hash) { return hash !== null; })
      .onValue(function(hash) { window.location.hash = hash; });

    hashHistory.onValue(setStorage.bind(null, 'hashHistory'));

    hashHistory
      .map(function(history) { return history.length == 0; })
      .assign($('#back'), 'attr', 'disabled');

    var loc = $(window)
      .asEventStream('hashchange', getCurrHash)
      .toProperty(window.location.hash)
      .map(function(hash) { return hash.slice(1) || 'start'; });

    loc.map(function(loc) { return loc == 'start'; })
      .assign($('#restart'), 'attr', 'disabled');

    loc.onValue(function(loc) {
        var el = document.getElementById(loc);
        if (el) {
          $('section').hide();
          $(el).show();
        }
      });

    $('#restart').asEventStream('click').onValue(function() {
      window.location.hash = '';
    });
  });
</script>
<button id="back">Back</button> <button id="restart">Restart</button>

<section id="start">
  <h1>Welcome!</h1>

  <p><a href="#wtf">What's all this stuff between lines 1-14? Is my computer being hacked?!</a></p>
  <p><a href="#hack">Hey, I've seen this stuff before. Show me how to build an app!</a></p>
</section>

<section id="wtf">
  <h1>Nope, it's code.</h1>
  <p>That is HTML, the language that all pages on the Web are made of.</p>
  <p><a href="#about-html">Oh neat, tell me more.</a></p>
  <p><a href="#hack">Ok, let's get started coding then!</a></p>
</section>

<section id="about-html">
  <h1>HTML is cool.</h1>
  <p>If a Web page were an organism, HTML would be like its bones,
    providing structure.</p>
  <p>HTML is made up of <em>tags</em>, which often come in pairs. For
    example, line 1 is an <em>opening</em> HTML tag, while line 14 is
    a <em>closing</em> HTML tag. You can identify tags by the
    <code>&lt;</code> and <code>&gt;</code> at either end.</p>
</section>

<section id="hack">
  <h1>Let's get started.</h1>
  <p>TODO: Finish this.</p>
</section>
