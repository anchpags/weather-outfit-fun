<!DOCTYPE html>
<meta charset="utf-8">
<link href="vendor/tutorial.css" rel="stylesheet">
<script src="../src/vendor/jquery.js"></script>
<script src="vendor/tutorial.js"></script>
<script src="vendor/bacon.js"></script>
<style>
section {
  display: none;
  line-height: 20px;
}

code {
  border: 1px solid lightgray;
  border-radius: 3px;
  background-color: #f0f0f0;
  padding: 0 2px;
}

aside {
  background-color: #f0f0f0;
  padding: 8px;
}

body .tutorial-nav button {
  width: auto;
  padding: 0 2px;
}
</style>
<script>
  function getCurrHash() {
    return window.location.hash.slice(1) || 'start';
  }

  function getStorage(key, defaultValue) {
    try {
      return JSON.parse(sessionStorage[key]);
    } catch (e) {
      return defaultValue;
    }
  }

  function setStorage(key, value) {
    try {
      sessionStorage[key] = JSON.stringify(value);
    } catch (e) {}
  }

  var HISTORY_START = getStorage('hashHistory', []);
  var LAST_HASH = getStorage('lastHash');
  var IN_IFRAME = (window.parent !== window);

  if (IN_IFRAME)
    window.location.replace('#' + LAST_HASH);

  $(function() {
    $('body').tutorial({
      paginate: false
    });

    var hashHistory = Bacon.update(
      HISTORY_START,

      [$('#back').asEventStream('click')],
      function(history) { return history.slice(0, -1); },

      [$('body').asEventStream('click', 'a[href^="#"]', getCurrHash)],
      function(history, hash) { return history.concat(hash); }
    );

    hashHistory
      .diff(HISTORY_START, function(prev, curr) {
        return prev.length > curr.length ? prev[prev.length-1] : null;
      })
      .filter(function(hash) { return hash !== null; })
      .onValue(function(hash) { window.location.hash = '#' + hash; });

    hashHistory.onValue(setStorage.bind(null, 'hashHistory'));

    hashHistory
      .map(function(history) { return history.length == 0; })
      .assign($('#back'), 'attr', 'disabled');

    var currHash = $(window)
      .asEventStream('hashchange', getCurrHash)
      .toProperty(getCurrHash());

    currHash.map(function(hash) { return hash == 'start'; })
      .assign($('#restart'), 'attr', 'disabled');

    if (IN_IFRAME)
      currHash.onValue(setStorage.bind(null, 'lastHash'));

    currHash.onValue(function(hash) {
        var el = document.getElementById(hash) || 
                 document.getElementById('404');
        $('section').hide();
        $(el).show();
      });

    $('#restart').asEventStream('click').onValue(function() {
      window.location.hash = '';
    });
  });
</script>
<div class="tutorial-nav">
<button id="back">Back</button> <button id="restart">Restart</button>
</div>

<section id="start">
  <h1>Welcome!</h1>

  <p><a href="#wtf">What's all this stuff between lines 1-14? Is my computer being hacked?!</a></p>
  <p><a href="#hack">Hey, I've seen this stuff before. Show me how to build an app!</a></p>
</section>

<section id="wtf">
  <h1>Nope, it's code.</h1>
  <p>That is HTML, the language that all pages on the Web are made of.</p>
  <p><a href="#about-html">Oh neat, tell me more.</a></p>
  <p><a href="#hack">Ok, let's get started coding then!</a></p>
</section>

<section id="about-html">
  <h1>HTML is cool.</h1>
  <p>If a Web page were an organism, HTML would be like its bones,
    providing structure.</p>
  <p>HTML is made up of <em>tags</em>, which often come in pairs. For
    example, line 1 is an <em>opening</em> HTML tag, while line 14 is
    a <em>closing</em> HTML tag. You can identify tags by the
    <code>&lt;</code> and <code>&gt;</code> at either end.</p>
  <p>A pair of tags and the space between them is sometimes called a <em>block</em> or <em>element</em> of HTML. The space between can contain text or more <em>nested</em> elements; when <a href="https://developer.mozilla.org/en-US/docs/Tools/3D_View" target="_blank">visualized</a>, this can look like a series of boxes stacked atop one another.</p>
  <p>For example, lines 2-9 comprise the <code>&lt;head&gt;</code> element,
    while lines 10-13 form the <code>&lt;body&gt;</code>. Both of
    these elements are nested in the <code>&lt;html&gt;</code> element.</p>

  <aside>
    <p>If you'd like to learn more about tags, try playing <a href="https://mousemeredith.makes.org/thimble/LTE2Mjc5Nzk3NzY=/tag-tag-revolution-activity" target="_blank">Tag Tag Revolution</a> with some friends.</p>
  </aside>

  <p><a href="#challenge-h1">I'd like to make my own tag.</a></p>
  <p><a href="#about-head">What's this about a "head" on line 2?</a></p>
  <p><a href="#about-css">What's this about a "stylesheet" on line 3?</a></p>
  <p><a href="#about-js">What's this about a "script" on line 4?</a></p>
  <p><a href="#about-body">What's this about a "body" on line 10?</a></p>
</section>

<section id="404">
  <h1>Sorry.</h1>
  <p>This section doesn't exist yet!</p>
</section>
