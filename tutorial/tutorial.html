<!DOCTYPE html>
<meta charset="utf-8">
<link href="vendor/tutorial.css" rel="stylesheet">
<link href="vendor/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="vendor/codemirror/codemirror.css" rel="stylesheet">
<script src="../src/vendor/jquery.js"></script>
<script src="../src/vendor/mustache.js"></script>
<script src="vendor/tutorial.js"></script>
<script src="vendor/bacon.js"></script>
<script src="vendor/codemirror/codemirror.js"></script>
<script src="vendor/codemirror/xml.js"></script>
<script src="vendor/codemirror/css.js"></script>
<script src="vendor/codemirror/javascript.js"></script>
<script src="vendor/codemirror/htmlmixed.js"></script>
<script src="vendor/codemirror/runmode.js"></script>
<script src="vendor/codemirror/colorize.js"></script>
<script src="common.js"></script>
<style>
section {
  display: none;
  line-height: 20px;
}

code {
  border: 1px solid lightgray;
  border-radius: 3px;
  background-color: #f0f0f0;
  padding: 0 2px;
}

aside {
  background-color: #f0f0f0;
  padding: 8px;
}

body .tutorial-nav button {
  width: auto;
  padding: 0 2px;
}

pre {
  white-space: pre-wrap;
  border-top: 1px solid lightgray;
  border-bottom: 1px solid lightgray;

  padding: 8px;
}

[data-show-when-challenge-done] {
  opacity: 0;
  transition: opacity 0.5s;
}

.done[data-show-when-challenge-done] {
  opacity: 1;
  color: green;
}
</style>
<script>
  function getCurrHash() {
    return window.location.hash.slice(1) || 'start';
  }

  function propAsBool(prop) {
    return function(obj) { return !!obj[prop]; };
  }

  var START_DATE = Date.now();
  var HISTORY_START = getStorage('hashHistory', []);
  var LAST_HASH = getStorage('lastHash');
  var IN_IFRAME = (window.parent !== window);

  if (IN_IFRAME)
    window.location.replace('#' + LAST_HASH);

  $(function() {
    $('pre').each(function() {
      $(this).text(Mustache.render($(this).text(), {baseURL: baseURL}));
    });

    CodeMirror.colorize();

    $('body').tutorial({
      paginate: false
    });

    var challenges = Bacon.fromPoll(1000, function() {
      var challenges = getStorage('challenges', {});
      if (!(challenges.date > START_DATE &&
            challenges.date > Date.now() - 5000))
        return new Bacon.Next({});
      return new Bacon.Next(challenges.data || {});
    });

    challenges.map(propAsBool('loaded'))
      .assign($('[data-show-when-challenge-done="loaded"]'),
              'toggleClass', 'done');

    var hashHistory = Bacon.update(
      HISTORY_START,

      [$('#back').asEventStream('click')],
      function(history) { return history.slice(0, -1); },

      [$('body').asEventStream('click', 'a[href^="#"]', getCurrHash)],
      function(history, hash) { return history.concat(hash); }
    );

    hashHistory
      .diff(HISTORY_START, function(prev, curr) {
        return prev.length > curr.length ? prev[prev.length-1] : null;
      })
      .filter(function(hash) { return hash !== null; })
      .onValue(function(hash) { window.location.hash = '#' + hash; });

    hashHistory.onValue(setStorage.bind(null, 'hashHistory'));

    hashHistory
      .map(function(history) { return history.length == 0; })
      .assign($('#back'), 'attr', 'disabled');

    var currHash = $(window)
      .asEventStream('hashchange', getCurrHash)
      .toProperty(getCurrHash());

    currHash.map(function(hash) { return hash == 'start'; })
      .assign($('#restart'), 'attr', 'disabled');

    if (IN_IFRAME)
      currHash.onValue(setStorage.bind(null, 'lastHash'));

    currHash.onValue(function(hash) {
        var el = document.getElementById(hash) || 
                 document.getElementById('404');
        $('section').hide();
        $(el).show();
      });

    $('#restart').asEventStream('click').onValue(function() {
      window.location.hash = '';
    });
  });
</script>
<div class="tutorial-nav">
<button id="back"><i class="fa fa-arrow-left"></i> Back</button> <button id="restart"><i class="fa fa-home"></i> Restart</button>
</div>

<section id="start">
  <h1>Welcome!</h1>

  <p><a href="#wtf">What's all this stuff between lines 1-14? Is my computer being hacked?!</a></p>
  <p><a href="#hack">Hey, I've seen this stuff before. Show me how to build an app!</a></p>
</section>

<section id="wtf">
  <h1>Nope, it's code.</h1>
  <p>That is HTML, the language that all pages on the Web are made of.</p>
  <p><a href="#about-html">Oh neat, tell me more.</a></p>
  <p><a href="#hack">Ok, let's get started coding then!</a></p>
</section>

<section id="about-html">
  <h1>HTML is cool.</h1>
  <p>If a Web page were an organism, HTML would be like its bones,
    providing structure.</p>
  <p>HTML is made up of <em>tags</em>, which often come in pairs. For
    example, line 1 is an <em>opening</em> HTML tag, while line 14 is
    a <em>closing</em> HTML tag. You can identify tags by the
    <code>&lt;</code> and <code>&gt;</code> at either end.</p>
  <p>A pair of tags and the space between them is sometimes called a <em>block</em> or <em>element</em> of HTML. The space between can contain text or more <em>nested</em> elements; when <a href="https://developer.mozilla.org/en-US/docs/Tools/3D_View" target="_blank">visualized</a>, this can look like a series of boxes stacked atop one another.</p>
  <p>For example, lines 2-9 comprise the <code>&lt;head&gt;</code> element,
    while lines 10-13 form the <code>&lt;body&gt;</code>. Both of
    these elements are nested in the <code>&lt;html&gt;</code> element.</p>

  <aside>
    <p>If you'd like to learn more about tags, try playing <a href="https://mousemeredith.makes.org/thimble/LTE2Mjc5Nzk3NzY=/tag-tag-revolution-activity" target="_blank">Tag Tag Revolution</a> with some friends.</p>
  </aside>

  <p><a href="#about-css">What's this "stylesheet" thing at line 3?</a></p>
  <p><a href="#hack">Okay, let's start writing some code.</a></p>
</section>

<section id="about-css">
  <h1>CSS is awesome.</h1>
  <p>Line 3 tells your browser to load a <em>stylesheet</em>.</p>
  <p>Stylesheets are written using a language called CSS, and are like the skin or clothing of a webpage: a set of rules draped over HTML to make it look pretty (or, in some cases, grotesque). In this case, it's making the background of our page greenish.</p>
  <aside>
    <p>Want to deep-dive? You can <a href="https://github.com/toolness/weather-outfit-fun/blob/gh-pages/weather-outfit.css" target="_blank">view the source</a> of the CSS file at line 3, and learn more about CSS at <a href="http://www.htmldog.com/guides/css/" target="_blank">HTML Dog</a>.</p>
  </aside>
  <p><a href="#hack">Okay, let's start writing some code.</a></p>
</section>

<section id="hack">
  <h1>Let's start coding.</h1>
  <p>The first thing we'll do is add a <em>script</em> to this webpage.</p>
  <p>Scripts are like the brain, muscles, and central nervous system of a webpage: they allow a page to respond to user input, talk to the internet, and change itself in ways that can transform it from an inert page into a full-fledged application.</p>
  <p>To add our script, type the following at line 4:</p>

  <pre data-lang="htmlmixed">&lt;script src="{{{baseURL}}}weather-outfit.js"&gt;&lt;/script&gt;</pre>

  <aside><p>Please do try to <em>type</em> the above code instead of copying and pasting it (copy-pasting just the URL is okay though). You'll learn better that way!</p></aside>

  <div data-show-when-challenge-done="loaded">
    <h2>Hooray!</h2>
    <p>The page is now loading the script, which is injecting an app into it.</p>
    <p><a href="#onwards">Onwards!</a></p>
  </div>
</section>

<section id="404">
  <h1>Sorry.</h1>
  <p>This section doesn't exist yet!</p>
</section>
