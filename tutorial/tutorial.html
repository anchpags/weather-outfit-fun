<!DOCTYPE html>
<meta charset="utf-8">
<link href="vendor/tutorial.css" rel="stylesheet">
<script src="../src/vendor/jquery.js"></script>
<script src="vendor/tutorial.js"></script>
<script src="vendor/bacon.js"></script>
<style>
section {
  display: none;
}
</style>
<script>
  function getCurrHash() { return window.location.hash; }

  function getStorage(key, defaultValue) {
    try {
      return JSON.parse(sessionStorage[key]);
    } catch (e) {
      return defaultValue;
    }
  }

  function setStorage(key, value) {
    try {
      sessionStorage[key] = JSON.stringify(value);
    } catch (e) {}
  }

  var HISTORY_START = getStorage('hashHistory', []);

  $(function() {
    $('body').tutorial({
      paginate: false
    });

    var hashHistory = Bacon.update(
      HISTORY_START,

      [$('#back').asEventStream('click')],
      function(history) { return history.slice(0, -1); },

      [$('body').asEventStream('click', 'a[href^="#"]', getCurrHash)],
      function(history, hash) { return history.concat(hash); }
    );

    hashHistory
      .diff(HISTORY_START, function(prev, curr) {
        return prev.length > curr.length ? prev[prev.length-1] : null;
      })
      .filter(function(hash) { return hash !== null; })
      .onValue(function(hash) { window.location.hash = hash; });

    hashHistory.onValue(setStorage.bind(null, 'hashHistory'));

    hashHistory
      .map(function(history) { return history.length == 0; })
      .assign($('#back'), 'attr', 'disabled');

    $(window)
      .asEventStream('hashchange', getCurrHash)
      .toProperty(window.location.hash)
      .onValue(function(hash) {
        var loc = hash.slice(1) || 'start';
        var el = document.getElementById(loc);
        if (el) {
          $('section').hide();
          $(el).show();
        }
      });
  });
</script>
<button id="back">Back</button>
<section id="start">
  <h1>Sup.</h1>
  <p>How's it goin at line 5 buddy ole <a href="#end">pal</a>.</p>
</section>
<section id="end">
  <h1>End.</h1>
  <p>How's it goin at line 3 <a href="#start">start</a>.</p>
</section>
