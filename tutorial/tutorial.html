<!DOCTYPE html>
<meta charset="utf-8">
<link href="vendor/tutorial.css" rel="stylesheet">
<script src="../src/vendor/jquery.js"></script>
<script src="vendor/tutorial.js"></script>
<script src="vendor/bacon.js"></script>
<style>
section {
  display: none;
}
</style>
<script>
  function getCurrHash() { return window.location.hash; }

  $(function() {
    $('body').tutorial({
      paginate: false
    });

    var hashHistory = $('body')
      .asEventStream('click', 'a[href^="#"]', getCurrHash)
      .merge($('#back').asEventStream('click').map('back'))
      .scan([], function(history, item) {
        return item == 'back' ? history.slice(0, -1) : history.concat(item);
      });

    hashHistory
      .diff([], function(prev, curr) {
        if (prev.length > curr.length)
          return prev[prev.length-1];
      })
      .filter(function(h) { return typeof(h) == 'string'; })
      .onValue(function(hash) { window.location.hash = hash; });

    hashHistory
      .map(function(history) { return history.length == 0; })
      .assign($('#back'), 'attr', 'disabled');

    $(window)
      .asEventStream('hashchange', getCurrHash)
      .toProperty(window.location.hash)
      .onValue(function(hash) {
        var loc = hash.slice(1) || 'start';
        var el = document.getElementById(loc);
        if (el) {
          $('section').hide();
          $(el).show();
        }
      });
  });
</script>
<button id="back">Back</button>
<section id="start">
  <h1>Sup.</h1>
  <p>How's it goin at line 5 buddy ole <a href="#end">pal</a>.</p>
</section>
<section id="end">
  <h1>End.</h1>
  <p>How's it goin at line 3 <a href="#start">start</a>.</p>
</section>
